<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIPRO+ ULTRA X - Sistema ITIL</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --secondary: #1e40af;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1f2937;
            --light: #f3f4f6;
            --bg: #ffffff;
            --text: #1f2937;
            --border: #e5e7eb;
            --shadow: rgba(0,0,0,0.1);
        }

        body.dark-mode {
            --bg: #111827;
            --text: #f3f4f6;
            --border: #374151;
            --light: #1f2937;
            --dark: #f3f4f6;
            --shadow: rgba(0,0,0,0.3);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--light);
            color: var(--text);
            transition: all 0.3s ease;
        }

        .loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            flex-direction: column;
        }

        .loader-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .loader-text {
            color: white;
            margin-top: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: var(--bg);
            border-right: 1px solid var(--border);
            padding: 20px;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 100;
            box-shadow: 2px 0 10px var(--shadow);
        }

        .sidebar.collapsed {
            transform: translateX(-100%);
        }

        .logo {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 30px;
            text-align: center;
        }

        .menu-item {
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .menu-item:hover {
            background: var(--primary);
            color: white;
            transform: translateX(5px);
        }

        .menu-item.active {
            background: var(--primary);
            color: white;
        }

        .main-content {
            margin-left: 260px;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .header {
            background: var(--bg);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .header-title {
            font-size: 24px;
            font-weight: bold;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: var(--bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow);
            transition: all 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 16px var(--shadow);
        }

        .kpi-label {
            font-size: 12px;
            color: #6b7280;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .kpi-value {
            font-size: 32px;
            font-weight: bold;
            color: var(--primary);
        }

        .kpi-trend {
            font-size: 12px;
            margin-top: 8px;
        }

        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: var(--bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .chart {
            width: 100%;
            height: 300px;
        }

        .table-container {
            background: var(--bg);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px var(--shadow);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: var(--light);
            font-weight: 600;
        }

        tr:hover {
            background: var(--light);
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-info { background: #dbeafe; color: #1e40af; }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 16px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 16px var(--shadow);
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg);
            padding: 30px;
            border-radius: 12px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text);
        }

        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .page-btn {
            padding: 8px 12px;
            border: 1px solid var(--border);
            background: var(--bg);
            border-radius: 6px;
            cursor: pointer;
        }

        .page-btn.active {
            background: var(--primary);
            color: white;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }
            
            .sidebar.show-mobile {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .kpi-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-grid {
                grid-template-columns: 1fr;
            }
        }

        .toggle-sidebar {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 101;
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        canvas {
            max-width: 100%;
        }
    </style>
</head>
<body>
    <div class="loader" id="loader">
        <div class="loader-spinner"></div>
        <div class="loader-text">Cargando SIPRO+ ULTRA X...</div>
    </div>

    <button class="toggle-sidebar" onclick="toggleSidebar()">‚ò∞</button>

    <div class="sidebar" id="sidebar">
        <div class="logo">üöÄ SIPRO+ ULTRA X</div>
        <div class="menu-item active" onclick="showSection('dashboard')">üìä Dashboard</div>
        <div class="menu-item" onclick="showSection('incidents')">üìã Incidentes</div>
        <div class="menu-item" onclick="showSection('history')">üìö Historial</div>
        <div class="menu-item" onclick="showSection('reports')">üìà Reportes</div>
        <div class="menu-item" onclick="showSection('rca')">üß† Causa Ra√≠z</div>
        <div class="menu-item" onclick="showSection('errors')">üíæ Errores Conocidos</div>
        <div class="menu-item" onclick="showSection('config')">‚öôÔ∏è Configuraci√≥n</div>
    </div>

    <div class="main-content" id="mainContent">
        <div class="header">
            <div class="header-title">Sistema ITIL de Gesti√≥n de Problemas</div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="toggleTheme()">üåì Tema</button>
                <button class="btn btn-success" onclick="openNewIncident()">‚ûï Nuevo Incidente</button>
            </div>
        </div>

        <!-- DASHBOARD -->
        <div class="section active" id="dashboard">
            <div class="kpi-grid" id="kpiGrid"></div>
            
            <!-- Panel de Problemas Destacados -->
            <div style="margin: 30px 0;">
                <h2 style="margin-bottom: 20px; color: var(--text);">üìä Panel de Problemas</h2>
                <div id="problemsPanel"></div>
            </div>
            
            <div class="chart-grid" id="chartGrid"></div>
        </div>

        <!-- INCIDENTES -->
        <div class="section" id="incidents">
            <div style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="showIncidentsTab()">üìã Incidentes</button>
                <button class="btn btn-warning" onclick="showProblemsTab()">‚ö†Ô∏è Problemas</button>
            </div>
            
            <div id="incidentsTab">
                <div class="filters" id="filters"></div>
                <div class="table-container">
                    <table id="incidentsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>T√≠tulo</th>
                                <th>Prioridad</th>
                                <th>Estado</th>
                                <th>Categor√≠a</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="incidentsTableBody"></tbody>
                    </table>
                    <div class="pagination" id="pagination"></div>
                </div>
            </div>

            <div id="problemsTab" style="display: none;">
                <div class="table-container">
                    <table id="problemsTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>T√≠tulo</th>
                                <th>Prioridad</th>
                                <th>Estado</th>
                                <th>Categor√≠a</th>
                                <th>Incidentes Relacionados</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="problemsTableBody"></tbody>
                    </table>
                    <div class="pagination" id="paginationProblems"></div>
                </div>
            </div>
        </div>

        <!-- HISTORIAL -->
        <div class="section" id="history">
            <div class="table-container">
                <h3>Historial de Eventos</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Tipo</th>
                            <th>Descripci√≥n</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- REPORTES -->
        <div class="section" id="reports">
            <div class="kpi-grid" id="reportsKpi"></div>
            <div class="chart-grid" id="reportsCharts"></div>
        </div>

        <!-- RCA -->
        <div class="section" id="rca">
            <div class="table-container">
                <h3>An√°lisis de Causa Ra√≠z</h3>
                <div id="rcaContent"></div>
            </div>
        </div>

        <!-- ERRORES CONOCIDOS -->
        <div class="section" id="errors">
            <div class="table-container">
                <h3>Errores Conocidos</h3>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Descripci√≥n</th>
                            <th>Estado</th>
                            <th>Soluci√≥n</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="errorsTableBody"></tbody>
                </table>
            </div>
        </div>

        <!-- CONFIGURACI√ìN -->
        <div class="section" id="config">
            <div class="table-container">
                <h3>Configuraci√≥n del Sistema</h3>
                <div class="form-group">
                    <label class="form-label">Generaci√≥n Autom√°tica</label>
                    <button class="btn btn-primary" onclick="toggleAutoGeneration()">Iniciar/Detener</button>
                    <p id="autoGenStatus">Estado: Detenido</p>
                </div>
                <div class="form-group">
                    <label class="form-label">Intervalo (segundos)</label>
                    <input type="number" class="form-control" id="intervalInput" value="5" min="1" max="60">
                </div>
                <div class="form-group">
                    <button class="btn btn-success" onclick="exportData('json')">üì• Exportar JSON</button>
                    <button class="btn btn-success" onclick="exportData('csv')">üì• Exportar CSV</button>
                    <button class="btn btn-warning" onclick="clearData()">üóëÔ∏è Limpiar Datos</button>
                    <button class="btn btn-danger" onclick="resetSystem()">üîÑ Restablecer Sistema</button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL -->
    <div class="modal" id="incidentModal">
        <div class="modal-content">
            <h3>Crear Incidente</h3>
            <form id="incidentForm">
                <div class="form-group">
                    <label class="form-label">T√≠tulo</label>
                    <input type="text" class="form-control" id="incidentTitle" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Descripci√≥n</label>
                    <textarea class="form-control" id="incidentDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Prioridad</label>
                    <select class="form-control" id="incidentPriority">
                        <option>Cr√≠tica</option>
                        <option>Alta</option>
                        <option>Media</option>
                        <option>Baja</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Categor√≠a</label>
                    <select class="form-control" id="incidentCategory">
                        <option>Hardware</option>
                        <option>Software</option>
                        <option>Red</option>
                        <option>Seguridad</option>
                        <option>Base de Datos</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Guardar</button>
                    <button type="button" class="btn btn-danger" onclick="closeModal()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let incidents = [];
        let problems = [];
        let history = [];
        let knownErrors = [];
        let autoGenInterval = null;
        let currentPage = 1;
        let currentProblemPage = 1;
        const itemsPerPage = 10;

        const priorities = ['Cr√≠tica', 'Alta', 'Media', 'Baja'];
        const states = ['Nuevo', 'En Progreso', 'Resuelto', 'Cerrado'];
        const categories = ['Hardware', 'Software', 'Red', 'Seguridad', 'Base de Datos'];
        const services = ['Correo', 'ERP', 'CRM', 'Base de Datos', 'Portal Web'];

        // Inicializaci√≥n
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('loader').style.display = 'none';
                loadData();
                renderDashboard();
                renderIncidentsTable();
                startAutoGeneration();
            }, 2000);
        });

        function loadData() {
            const saved = localStorage.getItem('siproData');
            if (saved) {
                const data = JSON.parse(saved);
                incidents = data.incidents || [];
                problems = data.problems || [];
                history = data.history || [];
                knownErrors = data.knownErrors || [];
            } else {
                generateInitialData();
            }
        }

        function saveData() {
            localStorage.setItem('siproData', JSON.stringify({
                incidents, problems, history, knownErrors
            }));
        }

        function generateInitialData() {
            for (let i = 0; i < 50; i++) {
                generateIncident();
            }
            for (let i = 0; i < 35; i++) {
                generateProblem();
            }
        }

        const problemTitles = [
            'Ca√≠das recurrentes del servidor de aplicaciones',
            'Lentitud cr√≥nica en base de datos de producci√≥n',
            'Fallas intermitentes en sistema de autenticaci√≥n',
            'P√©rdida de paquetes en red corporativa',
            'Errores frecuentes en proceso de respaldos',
            'Degradaci√≥n progresiva del rendimiento del ERP',
            'Fallas sistem√°ticas en sincronizaci√≥n de datos',
            'Problemas repetitivos en servicio de correo',
            'Inestabilidad en plataforma de virtualizaci√≥n',
            'Errores recurrentes en integraci√≥n con sistemas externos',
            'Sobrecarga constante en servidores web',
            'Fallas peri√≥dicas en sistema de monitoreo',
            'Problemas cr√≥nicos de memoria RAM',
            'Errores repetitivos en proceso de actualizaci√≥n',
            'Inestabilidad en conexiones VPN',
            'Fallas sistem√°ticas en balanceador de carga',
            'Problemas recurrentes con certificados SSL',
            'Errores frecuentes en replicaci√≥n de datos',
            'Degradaci√≥n en sistema de almacenamiento',
            'Fallas intermitentes en firewall corporativo',
            'Problemas repetitivos en sistema de tickets',
            'Errores cr√≥nicos en sistema de reportes',
            'Inestabilidad en servicios cloud',
            'Fallas recurrentes en API REST',
            'Problemas sistem√°ticos en DNS',
            'Errores frecuentes en servidor FTP',
            'Degradaci√≥n en sistema de colas',
            'Fallas peri√≥dicas en middleware',
            'Problemas recurrentes con proxy',
            'Errores intermitentes en sistema de logs'
        ];

        function generateProblem() {
            const relatedIncidents = [];
            const numIncidents = Math.floor(Math.random() * 5) + 2;
            for (let i = 0; i < numIncidents && i < incidents.length; i++) {
                relatedIncidents.push(incidents[Math.floor(Math.random() * incidents.length)].id);
            }

            const problem = {
                id: 'PRB-' + Date.now() + Math.random().toString(36).substr(2, 9),
                title: problemTitles[Math.floor(Math.random() * problemTitles.length)],
                description: 'Problema identificado a partir de m√∫ltiples incidentes relacionados',
                priority: priorities[Math.floor(Math.random() * priorities.length)],
                state: states[Math.floor(Math.random() * states.length)],
                category: categories[Math.floor(Math.random() * categories.length)],
                service: services[Math.floor(Math.random() * services.length)],
                timestamp: new Date(),
                technician: 'Equipo de Problemas',
                relatedIncidents: relatedIncidents,
                rootCause: null,
                proposedSolution: null,
                workaround: null,
                knownError: Math.random() > 0.5
            };
            problems.push(problem);
            addHistory('Creaci√≥n', `Problema ${problem.id} creado`);
            saveData();
        }

        const incidentTitles = [
            'Error en servidor de aplicaciones',
            'Fallo en base de datos principal',
            'Ca√≠da del servicio de correo electr√≥nico',
            'Problema de conectividad en red corporativa',
            'Sistema ERP no responde',
            'Portal web inaccesible',
            'Lentitud extrema en CRM',
            'Error cr√≠tico en sistema de respaldos',
            'Falla de autenticaci√≥n en Active Directory',
            'Disco duro con mal funcionamiento',
            'Sobrecarga en servidor web',
            'Error en certificado SSL',
            'Problemas con firewall corporativo',
            'Fallo en sistema de monitoreo',
            'Base de datos corrupta',
            'P√©rdida de conectividad VPN',
            'Error en actualizaciones autom√°ticas',
            'Sistema de archivos lleno',
            'Problemas de rendimiento en aplicaci√≥n',
            'Fallo en balanceador de carga'
        ];

        function generateIncident() {
            const incident = {
                id: 'INC-' + Date.now() + Math.random().toString(36).substr(2, 9),
                title: incidentTitles[Math.floor(Math.random() * incidentTitles.length)],
                description: 'Descripci√≥n del incidente generado autom√°ticamente',
                priority: priorities[Math.floor(Math.random() * priorities.length)],
                state: states[Math.floor(Math.random() * states.length)],
                category: categories[Math.floor(Math.random() * categories.length)],
                service: services[Math.floor(Math.random() * services.length)],
                timestamp: new Date(),
                technician: 'T√©cnico ' + Math.floor(Math.random() * 10),
                sla: Math.random() > 0.7,
                rootCause: null,
                proposedSolution: null
            };
            incidents.push(incident);
            addHistory('Creaci√≥n', `Incidente ${incident.id} creado`);
            saveData();
        }

        function addHistory(type, description) {
            history.unshift({
                type,
                description,
                timestamp: new Date()
            });
            if (history.length > 100) history.pop();
        }

        function renderDashboard() {
            const activeProblems = problems.filter(p => p.state === 'Nuevo' || p.state === 'En Progreso').length;
            const resolvedProblems = problems.filter(p => p.state === 'Resuelto').length;
            const closedProblems = problems.filter(p => p.state === 'Cerrado').length;
            const criticalProblems = problems.filter(p => p.priority === 'Cr√≠tica').length;
            
            const kpis = [
                { label: 'Total Incidentes', value: incidents.length, trend: '+5%' },
                { label: 'Total Problemas', value: problems.length, trend: '+12%' },
                { label: 'Problemas Activos', value: activeProblems, trend: '-3%' },
                { label: 'Problemas Resueltos', value: resolvedProblems, trend: '+18%' },
                { label: 'Problemas Cerrados', value: closedProblems, trend: '+8%' },
                { label: 'Incidentes Cr√≠ticos', value: incidents.filter(i => i.priority === 'Cr√≠tica').length, trend: '+8%' },
                { label: 'Problemas Cr√≠ticos', value: criticalProblems, trend: '+6%' },
                { label: 'SLA Cumplido', value: Math.round((incidents.filter(i => i.sla).length / incidents.length) * 100) + '%', trend: '+1%' },
                { label: 'Tiempo Promedio', value: '4.5h', trend: '-10%' },
                { label: 'Errores Conocidos', value: knownErrors.length, trend: '+3%' },
                { label: 'Tasa Escalaci√≥n', value: Math.round((problems.length / incidents.length) * 100) + '%', trend: '+2%' },
                { label: 'Problemas Reabiertos', value: Math.floor(problems.length * 0.08), trend: '-5%' }
            ];

            const kpiGrid = document.getElementById('kpiGrid');
            kpiGrid.innerHTML = kpis.map(kpi => `
                <div class="kpi-card">
                    <div class="kpi-label">${kpi.label}</div>
                    <div class="kpi-value">${kpi.value}</div>
                    <div class="kpi-trend">${kpi.trend}</div>
                </div>
            `).join('');

            renderCharts();
            renderProblemsPanel();
        }

        function renderCharts() {
            const chartGrid = document.getElementById('chartGrid');
            chartGrid.innerHTML = `
                <div class="chart-container">
                    <div class="chart-title">Incidentes por Prioridad</div>
                    <canvas id="chart1"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Problemas por Estado</div>
                    <canvas id="chart2"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Tendencia de Incidentes</div>
                    <canvas id="chart3"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Incidentes por Servicio</div>
                    <canvas id="chart4"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Distribuci√≥n por Categor√≠a</div>
                    <canvas id="chart5"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">SLA vs Prioridad</div>
                    <canvas id="chart6"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Problemas por Prioridad</div>
                    <canvas id="chart7"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Problemas Activos vs Cerrados</div>
                    <canvas id="chart8"></canvas>
                </div>
            `;

            // Chart 1: Barras - Prioridad
            const priorityData = priorities.map(p => incidents.filter(i => i.priority === p).length);
            new Chart(document.getElementById('chart1'), {
                type: 'bar',
                data: {
                    labels: priorities,
                    datasets: [{
                        label: 'Incidentes',
                        data: priorityData,
                        backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#10b981']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true
                }
            });

            // Chart 2: Dona - Estados de Problemas
            const problemStateData = states.map(s => problems.filter(p => p.state === s).length);
            new Chart(document.getElementById('chart2'), {
                type: 'doughnut',
                data: {
                    labels: states,
                    datasets: [{
                        data: problemStateData,
                        backgroundColor: ['#3b82f6', '#f59e0b', '#10b981', '#6b7280']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Chart 3: L√≠neas - Tendencia
            new Chart(document.getElementById('chart3'), {
                type: 'line',
                data: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Incidentes',
                        data: [12, 19, 15, 25, 22, 30],
                        borderColor: '#2563eb',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true
                }
            });

            // Chart 4: Pastel - Servicios
            const serviceData = services.map(s => incidents.filter(i => i.service === s).length);
            new Chart(document.getElementById('chart4'), {
                type: 'pie',
                data: {
                    labels: services,
                    datasets: [{
                        data: serviceData,
                        backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#10b981', '#8b5cf6']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Chart 5: Barras - Categor√≠as
            const categoryData = categories.map(c => incidents.filter(i => i.category === c).length);
            new Chart(document.getElementById('chart5'), {
                type: 'bar',
                data: {
                    labels: categories,
                    datasets: [{
                        label: 'Incidentes',
                        data: categoryData,
                        backgroundColor: '#3b82f6'
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: true
                }
            });

            // Chart 6: Radar - SLA
            new Chart(document.getElementById('chart6'), {
                type: 'radar',
                data: {
                    labels: priorities,
                    datasets: [{
                        label: 'SLA Cumplido',
                        data: priorities.map(p => {
                            const total = incidents.filter(i => i.priority === p).length;
                            const withSLA = incidents.filter(i => i.priority === p && i.sla).length;
                            return total > 0 ? Math.round((withSLA / total) * 100) : 0;
                        }),
                        backgroundColor: 'rgba(37, 99, 235, 0.2)',
                        borderColor: '#2563eb'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true
                }
            });

            // Chart 7: Barras - Problemas por Prioridad
            const problemPriorityData = priorities.map(p => problems.filter(pr => pr.priority === p).length);
            new Chart(document.getElementById('chart7'), {
                type: 'bar',
                data: {
                    labels: priorities,
                    datasets: [{
                        label: 'Problemas',
                        data: problemPriorityData,
                        backgroundColor: ['#dc2626', '#ea580c', '#0284c7', '#059669']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true
                }
            });

            // Chart 8: Barras apiladas - Problemas Activos vs Cerrados
            const activeProblems = problems.filter(p => p.state === 'Nuevo' || p.state === 'En Progreso').length;
            const resolvedProblems = problems.filter(p => p.state === 'Resuelto').length;
            const closedProblems = problems.filter(p => p.state === 'Cerrado').length;
            
            new Chart(document.getElementById('chart8'), {
                type: 'bar',
                data: {
                    labels: ['Problemas'],
                    datasets: [{
                        label: 'Activos',
                        data: [activeProblems],
                        backgroundColor: '#f59e0b'
                    }, {
                        label: 'Resueltos',
                        data: [resolvedProblems],
                        backgroundColor: '#10b981'
                    }, {
                        label: 'Cerrados',
                        data: [closedProblems],
                        backgroundColor: '#6b7280'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        x: { stacked: true },
                        y: { stacked: true }
                    }
                }
            });
        }

        function renderIncidentsTable() {
            const tbody = document.getElementById('incidentsTableBody');
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageIncidents = incidents.slice(start, end);

            tbody.innerHTML = pageIncidents.map(inc => `
                <tr>
                    <td><strong>${inc.id}</strong></td>
                    <td style="min-width: 200px;">
                        <strong>${inc.title}</strong>
                        <br>
                        <small style="color: #6b7280;">${inc.description}</small>
                    </td>
                    <td><span class="badge badge-${getPriorityClass(inc.priority)}">${inc.priority}</span></td>
                    <td><span class="badge badge-${getStateClass(inc.state)}">${inc.state}</span></td>
                    <td>${inc.category}</td>
                    <td style="min-width: 300px;">
                        <button class="btn btn-primary" style="font-size: 12px; padding: 6px 10px; margin: 2px;" onclick="editIncident('${inc.id}')">‚úèÔ∏è Editar</button>
                        <button class="btn btn-warning" style="font-size: 12px; padding: 6px 10px; margin: 2px;" onclick="showRootCause('${inc.id}', 'incident')">üîç Generar Causa Ra√≠z</button>
                        <button class="btn btn-success" style="font-size: 12px; padding: 6px 10px; margin: 2px;" onclick="showProposedSolution('${inc.id}', 'incident')">üí° Mostrar Soluci√≥n Propuesta</button>
                        <button class="btn btn-danger" style="font-size: 12px; padding: 6px 10px; margin: 2px;" onclick="deleteIncident('${inc.id}')">üóëÔ∏è Eliminar</button>
                    </td>
                </tr>
            `).join('');

            renderPagination();
            renderProblemsTable();
            renderHistory();
            renderKnownErrors();
        }

        function renderProblemsTable() {
            const tbody = document.getElementById('problemsTableBody');
            const start = (currentProblemPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageProblems = problems.slice(start, end);

            tbody.innerHTML = pageProblems.map(prb => `
                <tr>
                    <td><strong>${prb.id}</strong></td>
                    <td style="min-width: 200px;">
                        <strong>${prb.title}</strong>
                        <br>
                        <small style="color: #6b7280;">${prb.description}</small>
                        ${prb.knownError ? '<br><span class="badge badge-danger">Error Conocido</span>' : ''}
                    </td>
                    <td><span class="badge badge-${getPriorityClass(prb.priority)}">${prb.priority}</span></td>
                    <td><span class="badge badge-${getStateClass(prb.state)}">${prb.state}</span></td>
                    <td>${prb.category}</td>
                    <td><span class="badge badge-info">${prb.relatedIncidents.length} incidentes</span></td>
                    <td style="min-width: 350px;">
                        <button class="btn btn-primary" style="font-size: 12px; padding: 6px 10px; margin: 2px;" onclick="viewRelatedIncidents('${prb.id}')">üëÅÔ∏è Ver Incidentes</button>
                        <button class="btn btn-warning" style="font-size: 12px; padding: 6px 10px; margin: 2px;" onclick="showRootCause('${prb.id}', 'problem')">üîç Generar Causa Ra√≠z</button>
                        <button class="btn btn-success" style="font-size: 12px; padding: 6px 10px; margin: 2px;" onclick="showProposedSolution('${prb.id}', 'problem')">üí° Soluci√≥n Propuesta</button>
                        <button class="btn btn-danger" style="font-size: 12px; padding: 6px 10px; margin: 2px;" onclick="deleteProblem('${prb.id}')">üóëÔ∏è Eliminar</button>
                    </td>
                </tr>
            `).join('');

            renderProblemsPagination();
        }

        function renderProblemsPagination() {
            const totalPages = Math.ceil(problems.length / itemsPerPage);
            const pagination = document.getElementById('paginationProblems');
            let html = '';
            for (let i = 1; i <= totalPages; i++) {
                html += `<button class="page-btn ${i === currentProblemPage ? 'active' : ''}" onclick="goToProblemPage(${i})">${i}</button>`;
            }
            pagination.innerHTML = html;
        }

        function goToProblemPage(page) {
            currentProblemPage = page;
            renderProblemsTable();
        }

        function showIncidentsTab() {
            document.getElementById('incidentsTab').style.display = 'block';
            document.getElementById('problemsTab').style.display = 'none';
        }

        function showProblemsTab() {
            document.getElementById('incidentsTab').style.display = 'none';
            document.getElementById('problemsTab').style.display = 'block';
            renderProblemsTable();
        }

        function viewRelatedIncidents(problemId) {
            const problem = problems.find(p => p.id === problemId);
            if (!problem) return;

            const relatedIncidentsInfo = problem.relatedIncidents.map(incId => {
                const inc = incidents.find(i => i.id === incId);
                return inc ? `<div style="padding: 10px; margin: 5px 0; background: var(--light); border-radius: 6px;">
                    <strong>${inc.id}</strong>: ${inc.title} - 
                    <span class="badge badge-${getPriorityClass(inc.priority)}">${inc.priority}</span>
                    <span class="badge badge-${getStateClass(inc.state)}">${inc.state}</span>
                </div>` : '';
            }).join('');

            const modalContent = `
                <div style="background: var(--bg); padding: 30px; border-radius: 12px; max-width: 700px; margin: 0 auto;">
                    <h2 style="color: var(--primary); margin-bottom: 20px;">üëÅÔ∏è Incidentes Relacionados</h2>
                    <p style="margin-bottom: 15px;"><strong>Problema:</strong> ${problem.id} - ${problem.title}</p>
                    
                    <div style="background: var(--light); padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="margin-bottom: 15px;">Total: ${problem.relatedIncidents.length} incidentes</h3>
                        ${relatedIncidentsInfo}
                    </div>

                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-primary" onclick="closeRelatedModal()">Cerrar</button>
                    </div>
                </div>
            `;

            const modal = document.createElement('div');
            modal.id = 'relatedModal';
            modal.className = 'modal active';
            modal.innerHTML = `<div style="max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;">${modalContent}</div>`;
            document.body.appendChild(modal);
        }

        function closeRelatedModal() {
            const modal = document.getElementById('relatedModal');
            if (modal) modal.remove();
        }

        function deleteProblem(id) {
            if (confirm('¬øEst√° seguro de eliminar este problema?')) {
                problems = problems.filter(p => p.id !== id);
                addHistory('Eliminaci√≥n', `Problema ${id} eliminado`);
                saveData();
                renderProblemsTable();
                showToast('Problema eliminado');
            }
        }

        function renderPagination() {
            const totalPages = Math.ceil(incidents.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            let html = '';
            for (let i = 1; i <= totalPages; i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            }
            pagination.innerHTML = html;
        }

        function goToPage(page) {
            currentPage = page;
            renderIncidentsTable();
        }

        function renderHistory() {
            const tbody = document.getElementById('historyTableBody');
            tbody.innerHTML = history.slice(0, 20).map(h => `
                <tr>
                    <td>${new Date(h.timestamp).toLocaleString()}</td>
                    <td><span class="badge badge-info">${h.type}</span></td>
                    <td>${h.description}</td>
                </tr>
            `).join('');
        }

        function renderKnownErrors() {
            const tbody = document.getElementById('errorsTableBody');
            tbody.innerHTML = knownErrors.map(err => `
                <tr>
                    <td>${err.id}</td>
                    <td>${err.description}</td>
                    <td><span class="badge badge-${err.state === 'Activo' ? 'danger' : 'success'}">${err.state}</span></td>
                    <td>${err.solution}</td>
                    <td>
                        <button class="btn btn-success" onclick="implementSolution('${err.id}')">Implementar</button>
                    </td>
                </tr>
            `).join('');
        }

        function getPriorityClass(priority) {
            const map = { 'Cr√≠tica': 'danger', 'Alta': 'warning', 'Media': 'info', 'Baja': 'success' };
            return map[priority] || 'info';
        }

        function getStateClass(state) {
            const map = { 'Nuevo': 'info', 'En Progreso': 'warning', 'Resuelto': 'success', 'Cerrado': 'secondary' };
            return map[state] || 'info';
        }

        function showSection(section) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(section).classList.add('active');
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            event.target.classList.add('active');

            if (window.innerWidth < 768) {
                document.getElementById('sidebar').classList.remove('show-mobile');
            }

            if (section === 'dashboard') renderDashboard();
            if (section === 'incidents') renderIncidentsTable();
            if (section === 'reports') renderReports();
            if (section === 'rca') renderRCA();
        }

        function renderReports() {
            const reportsKpi = document.getElementById('reportsKpi');
            const criticalOpen = problems.filter(p => p.priority === 'Cr√≠tica' && p.state !== 'Cerrado').length;
            const avgResolution = '6.3h';
            const escalationRate = Math.round((problems.length / incidents.length) * 100);
            const slaCompliance = Math.round((incidents.filter(i => i.sla).length / incidents.length) * 100);

            reportsKpi.innerHTML = `
                <div class="kpi-card">
                    <div class="kpi-label">Cumplimiento SLA</div>
                    <div class="kpi-value">${slaCompliance}%</div>
                    <div class="kpi-trend">+2% vs mes anterior</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Problemas Cr√≠ticos Abiertos</div>
                    <div class="kpi-value">${criticalOpen}</div>
                    <div class="kpi-trend">-1 vs semana anterior</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Tiempo Promedio Resoluci√≥n</div>
                    <div class="kpi-value">${avgResolution}</div>
                    <div class="kpi-trend">-15% mejora</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Tasa de Escalaci√≥n</div>
                    <div class="kpi-value">${escalationRate}%</div>
                    <div class="kpi-trend">+1% vs mes anterior</div>
                </div>
            `;

            const reportsCharts = document.getElementById('reportsCharts');
            reportsCharts.innerHTML = `
                <div class="chart-container">
                    <div class="chart-title">An√°lisis Pareto - Causas Ra√≠z</div>
                    <canvas id="reportChart1"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Problemas por √Årea de Negocio</div>
                    <canvas id="reportChart2"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Efectividad de Soluciones</div>
                    <canvas id="reportChart3"></canvas>
                </div>
                <div class="chart-container">
                    <div class="chart-title">Mapa de Calor - Incidentes por Hora</div>
                    <canvas id="reportChart4"></canvas>
                </div>
            `;

            // Pareto Chart
            new Chart(document.getElementById('reportChart1'), {
                type: 'bar',
                data: {
                    labels: ['Error Config', 'Falla Hardware', 'Bug Software', 'Error Red', 'Falta Capacitaci√≥n'],
                    datasets: [{
                        label: 'Frecuencia',
                        data: [45, 30, 25, 15, 10],
                        backgroundColor: '#3b82f6'
                    }, {
                        label: 'Acumulado %',
                        data: [36, 60, 80, 92, 100],
                        type: 'line',
                        borderColor: '#ef4444',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    scales: {
                        y1: {
                            type: 'linear',
                            position: 'right',
                            max: 100
                        }
                    }
                }
            });

            // √Årea de Negocio
            new Chart(document.getElementById('reportChart2'), {
                type: 'polarArea',
                data: {
                    labels: ['Ventas', 'Finanzas', 'RRHH', 'IT', 'Operaciones'],
                    datasets: [{
                        data: [25, 20, 15, 30, 10],
                        backgroundColor: ['#ef4444', '#f59e0b', '#3b82f6', '#10b981', '#8b5cf6']
                    }]
                }
            });

            // Efectividad
            new Chart(document.getElementById('reportChart3'), {
                type: 'bar',
                data: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Soluciones Efectivas',
                        data: [85, 88, 92, 90, 94, 95],
                        backgroundColor: '#10b981'
                    }, {
                        label: 'Soluciones Fallidas',
                        data: [15, 12, 8, 10, 6, 5],
                        backgroundColor: '#ef4444'
                    }]
                },
                options: {
                    scales: {
                        x: { stacked: true },
                        y: { stacked: true }
                    }
                }
            });

            // Heatmap simplificado
            new Chart(document.getElementById('reportChart4'), {
                type: 'bar',
                data: {
                    labels: ['00-06h', '06-12h', '12-18h', '18-24h'],
                    datasets: [{
                        label: 'Lunes',
                        data: [5, 20, 35, 15],
                        backgroundColor: '#3b82f6'
                    }, {
                        label: 'Martes',
                        data: [8, 25, 40, 18],
                        backgroundColor: '#8b5cf6'
                    }, {
                        label: 'Mi√©rcoles',
                        data: [10, 30, 45, 20],
                        backgroundColor: '#10b981'
                    }]
                }
            });
        }

        function renderRCA() {
            const rcaContent = document.getElementById('rcaContent');
            rcaContent.innerHTML = `
                <div style="margin: 20px 0;">
                    <h4>üîç M√©todo de los 5 Porqu√©s</h4>
                    <div style="padding: 20px; background: var(--light); border-radius: 8px; margin: 10px 0;">
                        <p><strong>Por qu√© 1:</strong> El servidor dej√≥ de responder</p>
                        <p><strong>Por qu√© 2:</strong> Se agot√≥ la memoria RAM</p>
                        <p><strong>Por qu√© 3:</strong> Hay una fuga de memoria en la aplicaci√≥n</p>
                        <p><strong>Por qu√© 4:</strong> El c√≥digo no libera recursos correctamente</p>
                        <p><strong>Por qu√© 5:</strong> No hay revisi√≥n de c√≥digo ni testing de memoria</p>
                        <p style="margin-top: 15px; color: var(--primary); font-weight: bold;">
                            ‚úÖ Causa Ra√≠z: Falta de proceso de revisi√≥n de c√≥digo y testing
                        </p>
                    </div>
                </div>

                <div style="margin: 20px 0;">
                    <h4>üêü Diagrama de Ishikawa (Espina de Pescado)</h4>
                    <div style="padding: 20px; background: var(--light); border-radius: 8px; margin: 10px 0;">
                        <p><strong>Personas:</strong> Falta de capacitaci√≥n, rotaci√≥n alta</p>
                        <p><strong>Procesos:</strong> No hay procedimientos documentados</p>
                        <p><strong>Tecnolog√≠a:</strong> Sistemas obsoletos, falta de monitoreo</p>
                        <p><strong>Entorno:</strong> Infraestructura insuficiente</p>
                    </div>
                </div>

                <div style="margin: 20px 0;">
                    <h4>üìä Matriz de Impacto</h4>
                    <table style="width: 100%; margin: 10px 0;">
                        <thead>
                            <tr>
                                <th>Causa</th>
                                <th>Probabilidad</th>
                                <th>Impacto</th>
                                <th>Prioridad</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Falla de Hardware</td>
                                <td><span class="badge badge-danger">Alta</span></td>
                                <td><span class="badge badge-danger">Alto</span></td>
                                <td><span class="badge badge-danger">Cr√≠tica</span></td>
                            </tr>
                            <tr>
                                <td>Error de Configuraci√≥n</td>
                                <td><span class="badge badge-warning">Media</span></td>
                                <td><span class="badge badge-warning">Medio</span></td>
                                <td><span class="badge badge-warning">Alta</span></td>
                            </tr>
                            <tr>
                                <td>Bug de Software</td>
                                <td><span class="badge badge-info">Baja</span></td>
                                <td><span class="badge badge-warning">Medio</span></td>
                                <td><span class="badge badge-info">Media</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div style="margin: 20px 0;">
                    <button class="btn btn-primary" onclick="generateRootCause()">ü§ñ Generar Causa Ra√≠z Autom√°tica</button>
                    <button class="btn btn-success" onclick="generateSolution()">üí° Generar Soluci√≥n Recomendada</button>
                </div>
            `;
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            if (window.innerWidth < 768) {
                sidebar.classList.toggle('show-mobile');
            } else {
                sidebar.classList.toggle('collapsed');
                mainContent.classList.toggle('expanded');
            }
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            showToast('Tema cambiado correctamente');
        }

        function openNewIncident() {
            document.getElementById('incidentModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('incidentModal').classList.remove('active');
        }

        document.getElementById('incidentForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const incident = {
                id: 'INC-' + Date.now(),
                title: document.getElementById('incidentTitle').value,
                description: document.getElementById('incidentDescription').value,
                priority: document.getElementById('incidentPriority').value,
                state: 'Nuevo',
                category: document.getElementById('incidentCategory').value,
                service: services[Math.floor(Math.random() * services.length)],
                timestamp: new Date(),
                technician: 'Usuario',
                sla: true
            };
            incidents.push(incident);
            addHistory('Creaci√≥n', `Incidente ${incident.id} creado manualmente`);
            saveData();
            closeModal();
            renderIncidentsTable();
            showToast('Incidente creado correctamente');
            document.getElementById('incidentForm').reset();
        });

        function editIncident(id) {
            const incident = incidents.find(i => i.id === id);
            if (incident) {
                const newState = prompt('Nuevo estado:', incident.state);
                if (newState) {
                    incident.state = newState;
                    addHistory('Edici√≥n', `Incidente ${id} actualizado`);
                    saveData();
                    renderIncidentsTable();
                    showToast('Incidente actualizado');
                }
            }
        }

        function deleteIncident(id) {
            if (confirm('¬øEst√° seguro de eliminar este incidente?')) {
                incidents = incidents.filter(i => i.id !== id);
                addHistory('Eliminaci√≥n', `Incidente ${id} eliminado`);
                saveData();
                renderIncidentsTable();
                showToast('Incidente eliminado');
            }
        }

        function implementSolution(id) {
            const error = knownErrors.find(e => e.id === id);
            if (error) {
                error.state = 'Resuelto';
                addHistory('Soluci√≥n', `Error conocido ${id} resuelto`);
                saveData();
                renderKnownErrors();
                showToast('Soluci√≥n implementada correctamente');
            }
        }

        function generateRootCause() {
            const causes = [
                'Configuraci√≥n incorrecta del sistema',
                'Falta de recursos de hardware',
                'Bug en el c√≥digo de la aplicaci√≥n',
                'Error en la base de datos',
                'Problema de red o conectividad',
                'Falta de mantenimiento preventivo'
            ];
            const cause = causes[Math.floor(Math.random() * causes.length)];
            showToast(`Causa ra√≠z identificada: ${cause}`);
        }

        function showRootCause(id, type) {
            const item = type === 'incident' ? incidents.find(i => i.id === id) : problems.find(p => p.id === id);
            if (!item) return;

            const rootCauses = [
                {
                    title: 'Configuraci√≥n incorrecta del sistema',
                    analysis: 'Se detect√≥ que los par√°metros de configuraci√≥n no coinciden con las especificaciones requeridas.',
                    why1: 'El sistema dej√≥ de funcionar correctamente',
                    why2: 'La configuraci√≥n fue modificada recientemente',
                    why3: 'No se sigui√≥ el procedimiento de cambios',
                    why4: 'Falta documentaci√≥n del proceso',
                    why5: 'No existe un sistema de gesti√≥n de cambios'
                },
                {
                    title: 'Falta de recursos de hardware',
                    analysis: 'El servidor ha alcanzado el l√≠mite de capacidad en CPU y memoria RAM.',
                    why1: 'El servidor presenta lentitud extrema',
                    why2: 'La carga de trabajo ha aumentado significativamente',
                    why3: 'No se dimension√≥ correctamente la infraestructura',
                    why4: 'No hay monitoreo proactivo de recursos',
                    why5: 'Falta planificaci√≥n de capacidad'
                },
                {
                    title: 'Bug cr√≠tico en el c√≥digo de la aplicaci√≥n',
                    analysis: 'Se identific√≥ un error en el m√≥dulo de autenticaci√≥n que causa fallos intermitentes.',
                    why1: 'Los usuarios no pueden acceder al sistema',
                    why2: 'El c√≥digo de autenticaci√≥n falla bajo ciertas condiciones',
                    why3: 'No se validaron todos los casos de uso',
                    why4: 'Las pruebas de QA fueron insuficientes',
                    why5: 'No existe un ambiente de staging completo'
                },
                {
                    title: 'Corrupci√≥n de datos en la base de datos',
                    analysis: 'Se detectaron inconsistencias en las tablas principales debido a una transacci√≥n interrumpida.',
                    why1: 'Las consultas devuelven errores',
                    why2: 'La base de datos tiene √≠ndices corruptos',
                    why3: 'Hubo un corte inesperado de energ√≠a',
                    why4: 'No hay sistema de UPS funcional',
                    why5: 'Falta mantenimiento preventivo de infraestructura'
                },
                {
                    title: 'Problema de conectividad de red',
                    analysis: 'El switch principal presenta fallas intermitentes en varios puertos.',
                    why1: 'Los usuarios pierden conexi√≥n frecuentemente',
                    why2: 'El equipo de red est√° fallando',
                    why3: 'El hardware est√° al final de su vida √∫til',
                    why4: 'No se realiz√≥ el reemplazo programado',
                    why5: 'No hay presupuesto aprobado para actualizaci√≥n'
                }
            ];

            const selectedCause = rootCauses[Math.floor(Math.random() * rootCauses.length)];
            item.rootCause = selectedCause;
            saveData();

            const modalContent = `
                <div style="background: var(--bg); padding: 30px; border-radius: 12px; max-width: 700px; margin: 0 auto;">
                    <h2 style="color: var(--primary); margin-bottom: 20px;">üîç An√°lisis de Causa Ra√≠z</h2>
                    <p style="margin-bottom: 15px;"><strong>${type === 'incident' ? 'Incidente' : 'Problema'}:</strong> ${item.id} - ${item.title}</p>
                    
                    <div style="background: var(--light); padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid var(--danger);">
                        <h3 style="color: var(--danger); margin-bottom: 15px;">‚úÖ Causa Ra√≠z Identificada</h3>
                        <p style="font-size: 18px; font-weight: bold; color: var(--primary);">${selectedCause.title}</p>
                        <p style="margin-top: 10px; color: var(--text);">${selectedCause.analysis}</p>
                    </div>

                    <div style="background: var(--light); padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">üîÑ M√©todo de los 5 Porqu√©s</h3>
                        <div style="margin: 10px 0; padding: 10px; background: var(--bg); border-radius: 6px;">
                            <strong>Por qu√© 1:</strong> ${selectedCause.why1}
                        </div>
                        <div style="margin: 10px 0; padding: 10px; background: var(--bg); border-radius: 6px;">
                            <strong>Por qu√© 2:</strong> ${selectedCause.why2}
                        </div>
                        <div style="margin: 10px 0; padding: 10px; background: var(--bg); border-radius: 6px;">
                            <strong>Por qu√© 3:</strong> ${selectedCause.why3}
                        </div>
                        <div style="margin: 10px 0; padding: 10px; background: var(--bg); border-radius: 6px;">
                            <strong>Por qu√© 4:</strong> ${selectedCause.why4}
                        </div>
                        <div style="margin: 10px 0; padding: 10px; background: var(--bg); border-radius: 6px;">
                            <strong>Por qu√© 5:</strong> ${selectedCause.why5}
                        </div>
                    </div>

                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-warning" onclick="regenerateRootCause('${id}', '${type}')">üîÑ Regenerar Causa Ra√≠z</button>
                        <button class="btn btn-primary" onclick="closeRCAModal()">Cerrar</button>
                    </div>
                </div>
            `;

            const existingModal = document.getElementById('rcaModal');
            if (existingModal) existingModal.remove();

            const modal = document.createElement('div');
            modal.id = 'rcaModal';
            modal.className = 'modal active';
            modal.innerHTML = `<div style="max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;">${modalContent}</div>`;
            document.body.appendChild(modal);

            addHistory('An√°lisis RCA', `Causa ra√≠z generada para ${type === 'incident' ? 'incidente' : 'problema'} ${item.id}: ${selectedCause.title}`);
            showToast('Causa ra√≠z generada exitosamente');
        }

        function regenerateRootCause(id, type) {
            showRootCause(id, type);
            showToast('Causa ra√≠z regenerada autom√°ticamente');
        }

        function showProposedSolution(id, type) {
            const item = type === 'incident' ? incidents.find(i => i.id === id) : problems.find(p => p.id === id);
            if (!item) return;

            const solutions = [
                {
                    title: 'Actualizaci√≥n de configuraci√≥n del sistema',
                    description: 'Revisar y corregir los par√°metros de configuraci√≥n seg√∫n las mejores pr√°cticas.',
                    steps: [
                        'Realizar backup de la configuraci√≥n actual',
                        'Revisar documentaci√≥n oficial del fabricante',
                        'Aplicar configuraci√≥n correcta en ambiente de pruebas',
                        'Validar funcionamiento en QA',
                        'Implementar en producci√≥n en ventana de mantenimiento'
                    ],
                    impact: 'Alto',
                    effort: 'Medio',
                    time: '4-6 horas'
                },
                {
                    title: 'Ampliaci√≥n de recursos de hardware',
                    description: 'Incrementar la capacidad de CPU, RAM y almacenamiento del servidor.',
                    steps: [
                        'Analizar m√©tricas de consumo actuales',
                        'Dimensionar recursos necesarios',
                        'Solicitar aprobaci√≥n de inversi√≥n',
                        'Adquirir hardware adicional',
                        'Programar ventana de mantenimiento',
                        'Instalar y configurar nuevos recursos'
                    ],
                    impact: 'Alto',
                    effort: 'Alto',
                    time: '2-3 semanas'
                },
                {
                    title: 'Correcci√≥n de bug y despliegue de parche',
                    description: 'Identificar, corregir y desplegar una soluci√≥n para el error en el c√≥digo.',
                    steps: [
                        'Reproducir el error en ambiente de desarrollo',
                        'Identificar la l√≠nea de c√≥digo problem√°tica',
                        'Desarrollar y probar la correcci√≥n',
                        'Crear parche de software',
                        'Realizar pruebas exhaustivas en QA',
                        'Desplegar en producci√≥n'
                    ],
                    impact: 'Alto',
                    effort: 'Medio',
                    time: '1-2 semanas'
                },
                {
                    title: 'Restauraci√≥n y optimizaci√≥n de base de datos',
                    description: 'Reparar la corrupci√≥n de datos y optimizar el rendimiento de la BD.',
                    steps: [
                        'Realizar backup completo de la base de datos',
                        'Ejecutar herramientas de reparaci√≥n',
                        'Reconstruir √≠ndices corruptos',
                        'Validar integridad de datos',
                        'Optimizar consultas lentas',
                        'Implementar monitoreo proactivo'
                    ],
                    impact: 'Cr√≠tico',
                    effort: 'Alto',
                    time: '8-12 horas'
                },
                {
                    title: 'Reemplazo de equipamiento de red',
                    description: 'Sustituir el hardware de red defectuoso por equipos nuevos.',
                    steps: [
                        'Identificar equipos en mal estado',
                        'Solicitar cotizaciones de reemplazo',
                        'Obtener aprobaci√≥n presupuestal',
                        'Adquirir equipos de reemplazo',
                        'Planificar migraci√≥n con m√≠nimo impacto',
                        'Instalar y configurar nuevos equipos',
                        'Validar conectividad completa'
                    ],
                    impact: 'Alto',
                    effort: 'Alto',
                    time: '3-4 semanas'
                }
            ];

            const selectedSolution = solutions[Math.floor(Math.random() * solutions.length)];
            item.proposedSolution = selectedSolution;
            saveData();

            const modalContent = `
                <div style="background: var(--bg); padding: 30px; border-radius: 12px; max-width: 700px; margin: 0 auto;">
                    <h2 style="color: var(--success); margin-bottom: 20px;">üí° Soluci√≥n Propuesta</h2>
                    <p style="margin-bottom: 15px;"><strong>${type === 'incident' ? 'Incidente' : 'Problema'}:</strong> ${item.id} - ${item.title}</p>
                    
                    <div style="background: var(--light); padding: 20px; border-radius: 8px; margin: 20px 0; border-left: 4px solid var(--success);">
                        <h3 style="color: var(--success); margin-bottom: 15px;">‚úÖ ${selectedSolution.title}</h3>
                        <p style="margin-top: 10px; color: var(--text); line-height: 1.6;">${selectedSolution.description}</p>
                    </div>

                    <div style="background: var(--light); padding: 20px; border-radius: 8px; margin: 20px 0;">
                        <h3 style="color: var(--primary); margin-bottom: 15px;">üìã Plan de Implementaci√≥n</h3>
                        ${selectedSolution.steps.map((step, index) => `
                            <div style="margin: 10px 0; padding: 12px; background: var(--bg); border-radius: 6px; display: flex; gap: 10px;">
                                <span style="background: var(--primary); color: white; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-weight: bold;">${index + 1}</span>
                                <span style="flex: 1;">${step}</span>
                            </div>
                        `).join('')}
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0;">
                        <div style="background: var(--light); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">IMPACTO</div>
                            <div style="font-weight: bold; color: #ef4444;">${selectedSolution.impact}</div>
                        </div>
                        <div style="background: var(--light); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">ESFUERZO</div>
                            <div style="font-weight: bold; color: #f59e0b;">${selectedSolution.effort}</div>
                        </div>
                        <div style="background: var(--light); padding: 15px; border-radius: 8px; text-align: center;">
                            <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">TIEMPO ESTIMADO</div>
                            <div style="font-weight: bold; color: #3b82f6;">${selectedSolution.time}</div>
                        </div>
                    </div>

                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-warning" onclick="regenerateSolution('${id}', '${type}')">üîÑ Regenerar Soluci√≥n</button>
                        <button class="btn btn-success" onclick="simulateImplementation('${id}', '${type}')">‚ñ∂Ô∏è Simular Implementaci√≥n</button>
                        <button class="btn btn-primary" onclick="closeSolutionModal()">Cerrar</button>
                    </div>
                </div>
            `;

            const existingModal = document.getElementById('solutionModal');
            if (existingModal) existingModal.remove();

            const modal = document.createElement('div');
            modal.id = 'solutionModal';
            modal.className = 'modal active';
            modal.innerHTML = `<div style="max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;">${modalContent}</div>`;
            document.body.appendChild(modal);

            addHistory('Soluci√≥n Propuesta', `Soluci√≥n generada para ${type === 'incident' ? 'incidente' : 'problema'} ${item.id}: ${selectedSolution.title}`);
            showToast('Soluci√≥n propuesta generada exitosamente');
        }

        function regenerateSolution(id, type) {
            showProposedSolution(id, type);
            showToast('Soluci√≥n regenerada autom√°ticamente');
        }

        function simulateImplementation(id, type) {
            const item = type === 'incident' ? incidents.find(i => i.id === id) : problems.find(p => p.id === id);
            if (!item || !item.proposedSolution) return;

            closeSolutionModal();

            const steps = item.proposedSolution.steps;
            let currentStep = 0;

            const simulationModal = document.createElement('div');
            simulationModal.id = 'simulationModal';
            simulationModal.className = 'modal active';
            
            const updateSimulation = () => {
                const progress = Math.round((currentStep / steps.length) * 100);
                
                simulationModal.innerHTML = `
                    <div style="background: var(--bg); padding: 30px; border-radius: 12px; max-width: 700px; margin: 0 auto;">
                        <h2 style="color: var(--warning); margin-bottom: 20px;">‚öôÔ∏è Simulaci√≥n de Implementaci√≥n</h2>
                        <p style="margin-bottom: 15px;"><strong>${type === 'incident' ? 'Incidente' : 'Problema'}:</strong> ${item.id}</p>
                        
                        <div style="background: var(--light); padding: 20px; border-radius: 8px; margin: 20px 0;">
                            <h3 style="margin-bottom: 15px;">Progreso: ${progress}%</h3>
                            <div style="background: #e5e7eb; height: 30px; border-radius: 15px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, #10b981, #2563eb); height: 100%; width: ${progress}%; transition: width 0.5s ease;"></div>
                            </div>
                        </div>

                            <div style="background: var(--light); padding: 20px; border-radius: 8px; margin: 20px 0; max-height: 300px; overflow-y: auto;">
                            <h3 style="margin-bottom: 15px;">Pasos Ejecutados:</h3>
                            ${steps.map((step, index) => `
                                <div style="margin: 10px 0; padding: 12px; background: ${index < currentStep ? '#d1fae5' : index === currentStep ? '#fef3c7' : '#f3f4f6'}; border-radius: 6px; display: flex; gap: 10px; align-items: center; transition: all 0.3s;">
                                    <span style="background: ${index < currentStep ? '#10b981' : index === currentStep ? '#f59e0b' : '#6b7280'}; color: white; width: 25px; height: 25px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-weight: bold;">
                                        ${index < currentStep ? '‚úì' : index + 1}
                                    </span>
                                    <span style="flex: 1;">${step}</span>
                                    ${index === currentStep ? '<span style="color: #f59e0b;">‚è≥ En progreso...</span>' : ''}
                                    ${index < currentStep ? '<span style="color: #10b981;">‚úÖ Completado</span>' : ''}
                                </div>
                            `).join('')}
                        </div>

                        ${currentStep >= steps.length ? `
                            <div style="background: #d1fae5; padding: 20px; border-radius: 8px; margin: 20px 0; text-align: center; border: 2px solid #10b981;">
                                <h2 style="color: #10b981; margin-bottom: 10px;">‚úÖ Implementaci√≥n Completada</h2>
                                <p style="color: #065f46;">La soluci√≥n se ha implementado exitosamente. El ${type === 'incident' ? 'incidente' : 'problema'} se ha marcado como resuelto.</p>
                            </div>
                            <div style="text-align: center;">
                                <button class="btn btn-success" onclick="closeSimulationModal()">Finalizar</button>
                            </div>
                        ` : ''}
                    </div>
                `;
            };

            document.body.appendChild(simulationModal);
            updateSimulation();

            const interval = setInterval(() => {
                currentStep++;
                updateSimulation();
                
                if (currentStep >= steps.length) {
                    clearInterval(interval);
                    item.state = 'Resuelto';
                    saveData();
                    addHistory('Implementaci√≥n', `Soluci√≥n implementada para ${type === 'incident' ? 'incidente' : 'problema'} ${item.id}`);
                    renderIncidentsTable();
                    renderProblemsTable();
                    showToast('Implementaci√≥n completada exitosamente');
                }
            }, 2000);
        }

        function closeSimulationModal() {
            const modal = document.getElementById('simulationModal');
            if (modal) modal.remove();
        }

        function renderProblemsPanel() {
            const panel = document.getElementById('problemsPanel');
            if (!panel) return;

            const activeProblems = problems.filter(p => p.state === 'Nuevo' || p.state === 'En Progreso');
            const criticalProblems = problems.filter(p => p.priority === 'Cr√≠tica');
            const recentProblems = problems.slice(-10).reverse();

            panel.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
                    <!-- Problemas Activos -->
                    <div style="background: var(--bg); padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="color: #f59e0b; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            ‚ö†Ô∏è Problemas Activos (${activeProblems.length})
                        </h3>
                        <div style="max-height: 300px; overflow-y: auto;">
                            ${activeProblems.length > 0 ? activeProblems.slice(0, 5).map(p => `
                                <div style="padding: 12px; margin: 8px 0; background: var(--light); border-radius: 8px; border-left: 4px solid #f59e0b;">
                                    <div style="font-weight: bold; margin-bottom: 5px;">${p.id}</div>
                                    <div style="font-size: 14px; margin-bottom: 5px;">${p.title}</div>
                                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                        <span class="badge badge-${getPriorityClass(p.priority)}">${p.priority}</span>
                                        <span class="badge badge-${getStateClass(p.state)}">${p.state}</span>
                                        <span class="badge badge-info">${p.relatedIncidents.length} inc.</span>
                                    </div>
                                </div>
                            `).join('') : '<p style="color: #6b7280; text-align: center; padding: 20px;">No hay problemas activos</p>'}
                        </div>
                        ${activeProblems.length > 5 ? `<div style="text-align: center; margin-top: 10px;"><button class="btn btn-primary" onclick="showSection('incidents'); showProblemsTab();">Ver todos</button></div>` : ''}
                    </div>

                    <!-- Problemas Cr√≠ticos -->
                    <div style="background: var(--bg); padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="color: #ef4444; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            üî¥ Problemas Cr√≠ticos (${criticalProblems.length})
                        </h3>
                        <div style="max-height: 300px; overflow-y: auto;">
                            ${criticalProblems.length > 0 ? criticalProblems.slice(0, 5).map(p => `
                                <div style="padding: 12px; margin: 8px 0; background: #fee2e2; border-radius: 8px; border-left: 4px solid #ef4444;">
                                    <div style="font-weight: bold; margin-bottom: 5px; color: #991b1b;">${p.id}</div>
                                    <div style="font-size: 14px; margin-bottom: 5px; color: #7f1d1d;">${p.title}</div>
                                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                        <span class="badge badge-danger">${p.state}</span>
                                        <span class="badge badge-info">${p.relatedIncidents.length} incidentes</span>
                                        ${p.knownError ? '<span class="badge badge-warning">Error Conocido</span>' : ''}
                                    </div>
                                </div>
                            `).join('') : '<p style="color: #6b7280; text-align: center; padding: 20px;">No hay problemas cr√≠ticos</p>'}
                        </div>
                        ${criticalProblems.length > 5 ? `<div style="text-align: center; margin-top: 10px;"><button class="btn btn-danger" onclick="showSection('incidents'); showProblemsTab();">Ver todos</button></div>` : ''}
                    </div>

                    <!-- Problemas Recientes -->
                    <div style="background: var(--bg); padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="color: #3b82f6; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            üïí Problemas Recientes (${recentProblems.length})
                        </h3>
                        <div style="max-height: 300px; overflow-y: auto;">
                            ${recentProblems.slice(0, 5).map(p => `
                                <div style="padding: 12px; margin: 8px 0; background: var(--light); border-radius: 8px; border-left: 4px solid #3b82f6;">
                                    <div style="font-weight: bold; margin-bottom: 5px;">${p.id}</div>
                                    <div style="font-size: 14px; margin-bottom: 5px;">${p.title}</div>
                                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                        <span class="badge badge-${getPriorityClass(p.priority)}">${p.priority}</span>
                                        <span class="badge badge-${getStateClass(p.state)}">${p.state}</span>
                                    </div>
                                    <small style="color: #6b7280; font-size: 12px;">${new Date(p.timestamp).toLocaleString()}</small>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Estad√≠sticas de Problemas -->
                    <div style="background: var(--bg); padding: 20px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <h3 style="color: #10b981; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                            üìà Estad√≠sticas
                        </h3>
                        <div style="display: grid; gap: 15px;">
                            <div style="padding: 15px; background: var(--light); border-radius: 8px;">
                                <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">Total de Problemas</div>
                                <div style="font-size: 24px; font-weight: bold; color: #2563eb;">${problems.length}</div>
                            </div>
                            <div style="padding: 15px; background: var(--light); border-radius: 8px;">
                                <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">Tasa de Resoluci√≥n</div>
                                <div style="font-size: 24px; font-weight: bold; color: #10b981;">
                                    ${problems.length > 0 ? Math.round((problems.filter(p => p.state === 'Resuelto' || p.state === 'Cerrado').length / problems.length) * 100) : 0}%
                                </div>
                            </div>
                            <div style="padding: 15px; background: var(--light); border-radius: 8px;">
                                <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">Errores Conocidos</div>
                                <div style="font-size: 24px; font-weight: bold; color: #f59e0b;">
                                    ${problems.filter(p => p.knownError).length}
                                </div>
                            </div>
                            <div style="padding: 15px; background: var(--light); border-radius: 8px;">
                                <div style="font-size: 12px; color: #6b7280; margin-bottom: 5px;">Promedio Inc./Problema</div>
                                <div style="font-size: 24px; font-weight: bold; color: #8b5cf6;">
                                    ${problems.length > 0 ? (problems.reduce((sum, p) => sum + p.relatedIncidents.length, 0) / problems.length).toFixed(1) : 0}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function closeRCAModal() {
            const modal = document.getElementById('rcaModal');
            if (modal) modal.remove();
        }

        function closeSolutionModal() {
            const modal = document.getElementById('solutionModal');
            if (modal) modal.remove();
        }

        function implementSolutionForIncident(id) {
            const incident = incidents.find(i => i.id === id);
            if (incident) {
                incident.state = 'Resuelto';
                addHistory('Soluci√≥n Implementada', `Soluci√≥n aplicada al incidente ${incident.id}`);
                saveData();
                renderIncidentsTable();
                closeSolutionModal();
                showToast('Soluci√≥n implementada con √©xito');
            }
        }

        function generateRootCause() {
            const causes = [
                'Configuraci√≥n incorrecta del sistema',
                'Falta de recursos de hardware',
                'Bug en el c√≥digo de la aplicaci√≥n',
                'Error en la base de datos',
                'Problema de red o conectividad',
                'Falta de mantenimiento preventivo'
            ];
            const cause = causes[Math.floor(Math.random() * causes.length)];
            showToast(`Causa ra√≠z identificada autom√°ticamente: ${cause}`);
            
            // Actualizar la vista de RCA
            const rcaContent = document.getElementById('rcaContent');
            if (rcaContent) {
                rcaContent.innerHTML += `
                    <div style="background: var(--light); padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid var(--success);">
                        <strong>Nueva causa ra√≠z generada:</strong> ${cause}
                        <br>
                        <small style="color: #6b7280;">${new Date().toLocaleString()}</small>
                    </div>
                `;
            }
        }

        function generateSolution() {
            const solutions = [
                'Actualizar configuraci√≥n del sistema',
                'Aumentar recursos de hardware',
                'Aplicar parche de software',
                'Optimizar consultas de base de datos',
                'Revisar configuraci√≥n de red',
                'Implementar mantenimiento programado'
            ];
            const solution = solutions[Math.floor(Math.random() * solutions.length)];
            showToast(`Soluci√≥n recomendada generada: ${solution}`);
            
            // Actualizar la vista de RCA
            const rcaContent = document.getElementById('rcaContent');
            if (rcaContent) {
                rcaContent.innerHTML += `
                    <div style="background: #d1fae5; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid var(--success);">
                        <strong>üí° Soluci√≥n recomendada:</strong> ${solution}
                        <br>
                        <small style="color: #065f46;">${new Date().toLocaleString()}</small>
                    </div>
                `;
            }
        }

        function generateSolution() {
            const solutions = [
                'Actualizar configuraci√≥n del sistema',
                'Aumentar recursos de hardware',
                'Aplicar parche de software',
                'Optimizar consultas de base de datos',
                'Revisar configuraci√≥n de red',
                'Implementar mantenimiento programado'
            ];
            const solution = solutions[Math.floor(Math.random() * solutions.length)];
            showToast(`Soluci√≥n recomendada: ${solution}`);
        }

        let autoGenRunning = false;

        function toggleAutoGeneration() {
            if (autoGenRunning) {
                stopAutoGeneration();
            } else {
                startAutoGeneration();
            }
        }

        function startAutoGeneration() {
            const interval = parseInt(document.getElementById('intervalInput').value) * 1000;
            autoGenInterval = setInterval(() => {
                // Generar incidente o problema aleatoriamente
                if (Math.random() > 0.7) {
                    generateProblem();
                    showToast('Nuevo problema generado autom√°ticamente');
                } else {
                    generateIncident();
                    showToast('Nuevo incidente generado autom√°ticamente');
                }
                renderDashboard();
                renderIncidentsTable();
            }, interval);
            autoGenRunning = true;
            document.getElementById('autoGenStatus').textContent = 'Estado: Activo';
        }

        function stopAutoGeneration() {
            if (autoGenInterval) {
                clearInterval(autoGenInterval);
                autoGenInterval = null;
            }
            autoGenRunning = false;
            document.getElementById('autoGenStatus').textContent = 'Estado: Detenido';
        }

        function exportData(format) {
            const data = { incidents, problems, history, knownErrors };
            
            if (format === 'json') {
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                downloadFile(blob, 'sipro-data.json');
            } else if (format === 'csv') {
                let csv = 'ID,T√≠tulo,Prioridad,Estado,Categor√≠a,Fecha\n';
                incidents.forEach(inc => {
                    csv += `${inc.id},${inc.title},${inc.priority},${inc.state},${inc.category},${new Date(inc.timestamp).toLocaleString()}\n`;
                });
                const blob = new Blob([csv], { type: 'text/csv' });
                downloadFile(blob, 'sipro-data.csv');
            }
            showToast(`Datos exportados en formato ${format.toUpperCase()}`);
        }

        function downloadFile(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        function clearData() {
            if (confirm('¬øEst√° seguro de limpiar todos los datos?')) {
                incidents = [];
                problems = [];
                history = [];
                knownErrors = [];
                saveData();
                renderDashboard();
                renderIncidentsTable();
                showToast('Datos limpiados correctamente');
            }
        }

        function resetSystem() {
            if (confirm('¬øEst√° seguro de restablecer el sistema? Esto eliminar√° todos los datos.')) {
                localStorage.removeItem('siproData');
                location.reload();
            }
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Generar algunos errores conocidos de ejemplo
        if (knownErrors.length === 0) {
            knownErrors = [
                {
                    id: 'ERR-001',
                    description: 'Fallo intermitente en el servidor de correo',
                    state: 'Activo',
                    solution: 'Reiniciar servicio cada 4 horas'
                },
                {
                    id: 'ERR-002',
                    description: 'Lentitud en consultas de base de datos',
                    state: 'Activo',
                    solution: 'Optimizaci√≥n de √≠ndices pendiente'
                },
                {
                    id: 'ERR-003',
                    description: 'Error de autenticaci√≥n en VPN',
                    state: 'Resuelto',
                    solution: 'Actualizaci√≥n de certificados aplicada'
                }
            ];
            saveData();
        }

        // Responsive: cerrar sidebar en m√≥vil al hacer clic fuera
        document.addEventListener('click', (e) => {
            if (window.innerWidth < 768) {
                const sidebar = document.getElementById('sidebar');
                const toggleBtn = document.querySelector('.toggle-sidebar');
                if (!sidebar.contains(e.target) && !toggleBtn.contains(e.target)) {
                    sidebar.classList.remove('show-mobile');
                }
            }
        });
    </script>
</body>
</html>
